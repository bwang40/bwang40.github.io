
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.llamaindex.ai/en/stable/understanding/putting_it_all_together/q_and_a/terms_definitions_tutorial/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../chatbots/building_a_chatbot/">
      
      
      <link rel="icon" href="../../../../_static/assets/LlamaLogoBrowserTab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>æœ¯è¯­ä¸å®šä¹‰æå–æŒ‡å— - LlamaIndex</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/style.css">
    
      <link rel="stylesheet" href="../../../../css/algolia.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-BYVB1ZVE6J"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-BYVB1ZVE6J",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-BYVB1ZVE6J",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="LlamaIndex" class="md-header__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LlamaIndex
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              æœ¯è¯­ä¸å®šä¹‰æå–æŒ‡å—
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      

<!-- Search interface -->
<div id="docsearch"></div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../" class="md-tabs__link">
          
  
    
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../use_cases/" class="md-tabs__link">
          
  
    
  
  Use Cases

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../examples/" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../module_guides/" class="md-tabs__link">
          
  
    
  
  Component Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../optimizing/production_rag/" class="md-tabs__link">
          
  
    
  
  Advanced Topics

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../api_reference/" class="md-tabs__link">
          
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../community/integrations/" class="md-tabs__link">
          
  
    
  
  Open-Source Community

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://docs.cloud.llamaindex.ai/" class="md-tabs__link">
        
  
    
  
  LlamaCloud

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="LlamaIndex" class="md-nav__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    LlamaIndex
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../.." class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Home
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Learn
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Learn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../using_llms/using_llms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using LLMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../agent/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Building agents
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../workflows/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Building Workflows
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../rag/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Building a RAG pipeline
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../extraction/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Structured Data Extraction
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tracing_and_debugging/tracing_and_debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tracing and Debugging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../evaluating/evaluating/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Evaluating
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Putting it all Together
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            Putting it all Together
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../apps/fullstack_app_guide/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Full-stack web application
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Q&A Patterns
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_9_3" id="__nav_2_9_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_9_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_9_3">
            <span class="md-nav__icon md-icon"></span>
            Q&A Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    æœ¯è¯­ä¸å®šä¹‰æå–æŒ‡å—
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    æœ¯è¯­ä¸å®šä¹‰æå–æŒ‡å—
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      æ–‡æœ¬ä¸Šä¼ 
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm" class="md-nav__link">
    <span class="md-ellipsis">
      LLM è®¾ç½®
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      æœ¯è¯­æå–ä¸å­˜å‚¨
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      ä¿å­˜æå–çš„æœ¯è¯­
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      æŸ¥è¯¢å·²æå–çš„æœ¯è¯­/å®šä¹‰
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      è¯•è¿è¡Œæµ‹è¯•
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¹è¿›#1 - åˆ›å»ºåˆå§‹ç´¢å¼•
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¹è¿›#2 - ï¼ˆä¼˜åŒ–ï¼‰æ›´å¥½çš„æç¤ºè¯
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¹è¿› #3 - å›¾åƒæ”¯æŒ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      æ€»ç»“/å†…å®¹æè¦
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../chatbots/building_a_chatbot/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Chatbots
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../structured_data/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Structured data
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../use_cases/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Use Cases
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../examples/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../module_guides/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Component Guides
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../optimizing/production_rag/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Advanced Topics
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../api_reference/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../community/integrations/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Open-Source Community
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.cloud.llamaindex.ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LlamaCloud
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      æ–‡æœ¬ä¸Šä¼ 
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llm" class="md-nav__link">
    <span class="md-ellipsis">
      LLM è®¾ç½®
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      æœ¯è¯­æå–ä¸å­˜å‚¨
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      ä¿å­˜æå–çš„æœ¯è¯­
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      æŸ¥è¯¢å·²æå–çš„æœ¯è¯­/å®šä¹‰
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      è¯•è¿è¡Œæµ‹è¯•
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¹è¿›#1 - åˆ›å»ºåˆå§‹ç´¢å¼•
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¹è¿›#2 - ï¼ˆä¼˜åŒ–ï¼‰æ›´å¥½çš„æç¤ºè¯
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¹è¿› #3 - å›¾åƒæ”¯æŒ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      æ€»ç»“/å†…å®¹æè¦
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="_1">æœ¯è¯­ä¸å®šä¹‰æå–æŒ‡å—<a class="headerlink" href="#_1" title="Permanent link">#</a></h1>
<p>Llama Index æœ‰è®¸å¤šå·²å……åˆ†æ–‡æ¡£åŒ–çš„åº”ç”¨åœºæ™¯ï¼ˆè¯­ä¹‰æœç´¢ã€æ‘˜è¦ç”Ÿæˆç­‰ï¼‰ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½å°†å…¶åº”ç”¨äºéå¸¸å…·ä½“çš„ç”¨ä¾‹ï¼</p>
<p>æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»ä½¿ç”¨ Llama Index ä»æ–‡æœ¬ä¸­æå–æœ¯è¯­å’Œå®šä¹‰çš„è®¾è®¡æµç¨‹ï¼ŒåŒæ—¶å…è®¸ç”¨æˆ·åç»­æŸ¥è¯¢è¿™äº›æœ¯è¯­ã€‚é€šè¿‡ <a href="https://streamlit.io/">Streamlit</a>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾æ„å»ºå‰ç«¯ç•Œé¢æ¥è¿è¡Œå’Œæµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶å¿«é€Ÿè¿­ä»£è®¾è®¡ã€‚</p>
<p>æœ¬æ•™ç¨‹å‡è®¾æ‚¨å·²å®‰è£… Python3.9+ åŠä»¥ä¸‹è½¯ä»¶åŒ…ï¼š
- llama-index
- streamlit</p>
<p>åŸºç¡€ç›®æ ‡æ˜¯ä»æ–‡æ¡£ä¸­æå–æ–‡æœ¬ï¼Œè·å–æœ¯è¯­åŠå…¶å®šä¹‰ï¼Œç„¶åä¸ºç”¨æˆ·æä¾›æŸ¥è¯¢è¯¥æœ¯è¯­çŸ¥è¯†åº“çš„æ–¹å¼ã€‚æ•™ç¨‹å°†æ¶µç›– Llama Index å’Œ Streamlit çš„åŠŸèƒ½ç‰¹æ€§ï¼Œå¹¶ä¸ºå¸¸è§é—®é¢˜æä¾›æœ‰è¶£çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ•™ç¨‹æœ€ç»ˆç‰ˆæœ¬å¯åœ¨<a href="https://github.com/abdulasiraj/A-Guide-to-Extracting-Terms-and-Definitions">æ­¤å¤„</a>è·å–ï¼Œå®æ—¶æ¼”ç¤ºç‰ˆå‘å¸ƒäº<a href="https://huggingface.co/spaces/Nobody4591/Llama_Index_Term_Extractor">Huggingface Spaces</a>ã€‚</p>
<h2 id="_2">æ–‡æœ¬ä¸Šä¼ <a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p>ç¬¬ä¸€æ­¥æ˜¯è®©ç”¨æˆ·èƒ½å¤Ÿæ‰‹åŠ¨è¾“å…¥æ–‡æœ¬ã€‚æˆ‘ä»¬ç”¨ Streamlit ç¼–å†™ç•Œé¢ä»£ç ï¼Œé€šè¿‡ <code>streamlit run app.py</code> å¯åŠ¨åº”ç”¨ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>

<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ğŸ¦™ Llama Index æœ¯è¯­æå–å™¨ ğŸ¦™&quot;</span><span class="p">)</span>

<span class="n">document_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_area</span><span class="p">(</span><span class="s2">&quot;è¾“å…¥åŸå§‹æ–‡æœ¬&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;æå–æœ¯è¯­å’Œå®šä¹‰&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">document_text</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;æå–ä¸­...&quot;</span><span class="p">):</span>
        <span class="n">extracted_terms</span> <span class="o">=</span> <span class="n">document_text</span>  <span class="c1"># å ä½ç¬¦ï¼</span>
    <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">extracted_terms</span><span class="p">)</span>
</code></pre></div>
<p>éå¸¸ç®€å•å¯¹å§ï¼ä½†ä½ ä¼šæ³¨æ„åˆ°åº”ç”¨ç›®å‰è¿˜æ²¡æœ‰å®é™…åŠŸèƒ½ã€‚è¦ä½¿ç”¨ llama_indexï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½® OpenAI LLMã€‚ç”±äº LLM æœ‰å¤šç§å¯é…ç½®é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç”¨æˆ·è‡ªè¡Œå†³å®šæœ€ä½³é…ç½®ã€‚åŒæ—¶åº”è¯¥å…è®¸ç”¨æˆ·è®¾ç½®æå–æœ¯è¯­çš„æç¤ºè¯ï¼ˆè¿™ä¹Ÿæœ‰åŠ©äºæˆ‘ä»¬è°ƒè¯•æœ€ä½³æ–¹æ¡ˆï¼‰ã€‚</p>
<h2 id="llm">LLM è®¾ç½®<a class="headerlink" href="#llm" title="Permanent link">#</a></h2>
<p>ä¸‹ä¸€æ­¥æ˜¯ä¸ºåº”ç”¨æ·»åŠ é€‰é¡¹å¡ï¼Œå°†ä¸åŒåŠŸèƒ½åˆ†åŒºæ˜¾ç¤ºã€‚æˆ‘ä»¬åˆ›å»º LLM è®¾ç½®å’Œæ–‡æœ¬ä¸Šä¼ ä¸¤ä¸ªé€‰é¡¹å¡ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>

<span class="n">DEFAULT_TERM_STR</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;åˆ—å‡ºä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„æ‰€æœ‰æœ¯è¯­åŠå…¶å®šä¹‰ï¼Œ&quot;</span>
    <span class="s2">&quot;æ¯è¡Œæ˜¾ç¤ºä¸€ç»„å¯¹åº”å…³ç³»ã€‚&quot;</span>
    <span class="s2">&quot;è‹¥æœ¯è¯­ç¼ºå°‘å®šä¹‰ï¼Œè¯·æ ¹æ®ä¸Šä¸‹æ–‡è¡¥å……ã€‚&quot;</span>
    <span class="s2">&quot;æ¯è¡Œæ ¼å¼å¦‚ä¸‹ï¼š</span><span class="se">\n</span><span class="s2">æœ¯è¯­: &lt;term&gt; å®šä¹‰: &lt;definition&gt;&quot;</span>
<span class="p">)</span>

<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ğŸ¦™ Llama Index æœ¯è¯­æå–å™¨ ğŸ¦™&quot;</span><span class="p">)</span>

<span class="n">setup_tab</span><span class="p">,</span> <span class="n">upload_tab</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">tabs</span><span class="p">([</span><span class="s2">&quot;è®¾ç½®&quot;</span><span class="p">,</span> <span class="s2">&quot;ä¸Šä¼ /æå–æœ¯è¯­&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="n">setup_tab</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;LLM è®¾ç½®&quot;</span><span class="p">)</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;åœ¨æ­¤è¾“å…¥ OpenAI API å¯†é’¥&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
    <span class="n">llm_name</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;é€‰æ‹© LLM&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt-4&quot;</span><span class="p">])</span>
    <span class="n">model_temperature</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span>
        <span class="s2">&quot;LLM æ¸©åº¦å€¼&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="p">)</span>
    <span class="n">term_extract_str</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_area</span><span class="p">(</span>
        <span class="s2">&quot;ç”¨äºæå–æœ¯è¯­å’Œå®šä¹‰çš„æŸ¥è¯¢è¯­å¥&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">DEFAULT_TERM_STR</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">with</span> <span class="n">upload_tab</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;æå–å¹¶æŸ¥è¯¢å®šä¹‰&quot;</span><span class="p">)</span>
    <span class="n">document_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_area</span><span class="p">(</span><span class="s2">&quot;è¾“å…¥åŸå§‹æ–‡æœ¬&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;æå–æœ¯è¯­å’Œå®šä¹‰&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">document_text</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;æå–ä¸­...&quot;</span><span class="p">):</span>
            <span class="n">extracted_terms</span> <span class="o">=</span> <span class="n">document_text</span>  <span class="c1"># å ä½ç¬¦ï¼</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">extracted_terms</span><span class="p">)</span>
</code></pre></div>
<p>ç°åœ¨åº”ç”¨æœ‰äº†ä¸¤ä¸ªé€‰é¡¹å¡ï¼Œæå¤§æ”¹å–„äº†ç•Œé¢ç»„ç»‡ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°æˆ‘æ·»åŠ äº†é»˜è®¤çš„æœ¯è¯­æå–æç¤ºâ€”â€”åç»­å°è¯•æå–æœ¯è¯­æ—¶å¯ä»¥ä¿®æ”¹è¿™ä¸ªæç¤ºï¼Œè¿™åªæ˜¯æˆ‘ç»è¿‡å®éªŒåå¾—å‡ºçš„åˆå§‹ç‰ˆæœ¬ã€‚</p>
<p>è¯´åˆ°æå–æœ¯è¯­ï¼Œç°åœ¨è¯¥æ·»åŠ ç›¸å…³åŠŸèƒ½å‡½æ•°äº†ï¼</p>
<h2 id="_3">æœ¯è¯­æå–ä¸å­˜å‚¨<a class="headerlink" href="#_3" title="Permanent link">#</a></h2>
<p>é…ç½®å¥½ LLM å¹¶è¾“å…¥æ–‡æœ¬åï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ Llama Index æå–æœ¯è¯­äº†ï¼</p>
<p>æ·»åŠ ä»¥ä¸‹å‡½æ•°æ¥åˆå§‹åŒ– LLM å¹¶ä»è¾“å…¥æ–‡æœ¬ä¸­æå–æœ¯è¯­ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">SummaryIndex</span><span class="p">,</span> <span class="n">load_index_from_storage</span>
<span class="kn">from</span> <span class="nn">llama_index.llms.openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="n">Settings</span>


<span class="k">def</span> <span class="nf">get_llm</span><span class="p">(</span><span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_key</span>
    <span class="k">return</span> <span class="n">OpenAI</span><span class="p">(</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">model_temperature</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">llm_name</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="n">max_tokens</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">extract_terms</span><span class="p">(</span>
    <span class="n">documents</span><span class="p">,</span> <span class="n">term_extract_str</span><span class="p">,</span> <span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span>
<span class="p">):</span>
    <span class="n">llm</span> <span class="o">=</span> <span class="n">get_llm</span><span class="p">(</span><span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

    <span class="n">temp_index</span> <span class="o">=</span> <span class="n">SummaryIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
        <span class="n">documents</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">query_engine</span> <span class="o">=</span> <span class="n">temp_index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
        <span class="n">response_mode</span><span class="o">=</span><span class="s2">&quot;tree_summarize&quot;</span><span class="p">,</span> <span class="n">llm</span><span class="o">=</span><span class="n">llm</span>
    <span class="p">)</span>
    <span class="n">terms_definitions</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query_engine</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">term_extract_str</span><span class="p">))</span>
    <span class="n">terms_definitions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">terms_definitions</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">and</span> <span class="s2">&quot;Term:&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="s2">&quot;Definition:&quot;</span> <span class="ow">in</span> <span class="n">x</span>
    <span class="p">]</span>
    <span class="c1"># å°†æ–‡æœ¬è§£æä¸ºå­—å…¸</span>
    <span class="n">terms_to_definition</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Definition:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Term:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Definition:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">terms_definitions</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">terms_to_definition</span>
</code></pre></div>
<p>ç°åœ¨ä½¿ç”¨æ–°å‡½æ•°ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æå–æœ¯è¯­äº†ï¼</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="k">with</span> <span class="n">upload_tab</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;æå–å¹¶æŸ¥è¯¢å®šä¹‰&quot;</span><span class="p">)</span>
    <span class="n">document_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_area</span><span class="p">(</span><span class="s2">&quot;è¾“å…¥åŸå§‹æ–‡æœ¬&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;æå–æœ¯è¯­å’Œå®šä¹‰&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">document_text</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;æå–ä¸­...&quot;</span><span class="p">):</span>
            <span class="n">extracted_terms</span> <span class="o">=</span> <span class="n">extract_terms</span><span class="p">(</span>
                <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">document_text</span><span class="p">)],</span>
                <span class="n">term_extract_str</span><span class="p">,</span>
                <span class="n">llm_name</span><span class="p">,</span>
                <span class="n">model_temperature</span><span class="p">,</span>
                <span class="n">api_key</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">extracted_terms</span><span class="p">)</span>
</code></pre></div>
<p>å½“å‰ä»£ç é‡è¾ƒå¤§ï¼Œè®©æˆ‘ä»¬æ¢³ç†å…³é”®æµç¨‹ï¼š</p>
<p><code>get_llm()</code> æ ¹æ®è®¾ç½®é€‰é¡¹å¡ä¸­çš„ç”¨æˆ·é…ç½®å®ä¾‹åŒ– LLMã€‚æ ¹æ®æ¨¡å‹åç§°é€‰æ‹©å¯¹åº”çš„ç±»ï¼ˆ<code>OpenAI</code> æˆ– <code>ChatOpenAI</code>ï¼‰ã€‚</p>
<p><code>extract_terms()</code> æ˜¯æ ¸å¿ƒåŠŸèƒ½æ‰€åœ¨ã€‚é¦–å…ˆè°ƒç”¨ <code>get_llm()</code> å¹¶è®¾ç½® <code>max_tokens=1024</code>ï¼Œå› ä¸ºæå–æœ¯è¯­æ—¶ä¸æƒ³è¿‡å¤šé™åˆ¶æ¨¡å‹ï¼ˆé»˜è®¤å€¼ä¸º 256ï¼‰ã€‚ç„¶åå®šä¹‰ <code>Settings</code> å¯¹è±¡ï¼Œå°† <code>num_output</code> ä¸ <code>max_tokens</code> å¯¹é½ï¼ŒåŒæ—¶è®¾ç½®å—å¤§å°ä¸è¶…è¿‡è¾“å‡ºå€¼ã€‚å½“ Llama Index ç´¢å¼•æ–‡æ¡£æ—¶ï¼Œå¤§æ–‡æ¡£ä¼šè¢«åˆ†å‰²æˆå—ï¼ˆç§°ä¸ºèŠ‚ç‚¹ï¼‰ï¼Œ<code>chunk_size</code> å³è®¾ç½®è¿™äº›å—çš„å¤§å°ã€‚</p>
<p>æ¥ç€åˆ›å»ºä¸´æ—¶æ‘˜è¦ç´¢å¼•å¹¶ä¼ å…¥ LLMã€‚æ‘˜è¦ç´¢å¼•ä¼šè¯»å–ç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æœ¬ç‰‡æ®µï¼Œéå¸¸é€‚åˆæœ¯è¯­æå–ã€‚æœ€åä½¿ç”¨é¢„å®šä¹‰çš„æŸ¥è¯¢æ–‡æœ¬ï¼Œé…åˆ <code>response_mode="tree_summarize"</code> æ¥æå–æœ¯è¯­ã€‚è¯¥å“åº”æ¨¡å¼ä¼šè‡ªåº•å‘ä¸Šç”Ÿæˆæ‘˜è¦æ ‘ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹æ±‡æ€»å…¶å­èŠ‚ç‚¹å†…å®¹ï¼Œæœ€ç»ˆè¿”å›æ ‘é¡¶åŒ…å«æ‰€æœ‰æå–çš„æœ¯è¯­å’Œå®šä¹‰ã€‚</p>
<p>æœ€åè¿›è¡Œç®€å•åå¤„ç†ï¼šå‡è®¾æ¨¡å‹éµå¾ªæŒ‡ä»¤å°†æœ¯è¯­/å®šä¹‰å¯¹é€è¡Œæ’åˆ—ï¼Œè·³è¿‡ç¼ºå°‘ <code>Term:</code> æˆ– <code>Definition:</code> æ ‡ç­¾çš„è¡Œï¼Œç„¶åè½¬æ¢ä¸ºå­—å…¸ä¾¿äºå­˜å‚¨ï¼</p>
<h2 id="_4">ä¿å­˜æå–çš„æœ¯è¯­<a class="headerlink" href="#_4" title="Permanent link">#</a></h2>
<p>ç°åœ¨èƒ½æå–æœ¯è¯­äº†ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å­˜å‚¨ä»¥ä¾¿åç»­æŸ¥è¯¢ã€‚ç›®å‰ <code>VectorStoreIndex</code> æ˜¯ç†æƒ³é€‰æ‹©ï¼æ­¤å¤–åº”ç”¨è¿˜åº”è·Ÿè¸ªå·²æ’å…¥ç´¢å¼•çš„æœ¯è¯­ï¼Œæ–¹ä¾¿åç»­æ£€æŸ¥ã€‚é€šè¿‡ <code>st.session_state</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼šè¯å­—å…¸ä¸­å­˜å‚¨å½“å‰æœ¯è¯­åˆ—è¡¨ï¼ˆæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ï¼‰ã€‚</p>
<p>é¦–å…ˆæ·»åŠ åˆå§‹åŒ–å…¨å±€å‘é‡ç´¢å¼•çš„åŠŸèƒ½å’Œæ’å…¥æå–æœ¯è¯­çš„å‡½æ•°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="n">Settings</span><span class="p">,</span> <span class="n">VectorStoreIndex</span>

<span class="o">...</span>
<span class="k">if</span> <span class="s2">&quot;all_terms&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TERMS</span>
<span class="o">...</span>


<span class="k">def</span> <span class="nf">insert_terms</span><span class="p">(</span><span class="n">terms_to_definition</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">definition</span> <span class="ow">in</span> <span class="n">terms_to_definition</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Term: </span><span class="si">{</span><span class="n">term</span><span class="si">}</span><span class="se">\n</span><span class="s2">Definition: </span><span class="si">{</span><span class="n">definition</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>


<span class="nd">@st</span><span class="o">.</span><span class="n">cache_resource</span>
<span class="k">def</span> <span class="nf">initialize_index</span><span class="p">(</span><span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åˆ›å»º VectorStoreIndex å¯¹è±¡&quot;&quot;&quot;</span>
    <span class="n">Settings</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">get_llm</span><span class="p">(</span><span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">VectorStoreIndex</span><span class="p">([])</span>

    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">llm</span>


<span class="o">...</span>

<span class="k">with</span> <span class="n">upload_tab</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;æå–å¹¶æŸ¥è¯¢å®šä¹‰&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;åˆå§‹åŒ–ç´¢å¼•å¹¶é‡ç½®æœ¯è¯­&quot;</span><span class="p">):</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initialize_index</span><span class="p">(</span>
            <span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span>
        <span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="s2">&quot;llama_index&quot;</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
            <span class="s2">&quot;å¯ä¸Šä¼ æ–‡æ¡£å›¾ç‰‡/æˆªå›¾ï¼Œæˆ–æ‰‹åŠ¨è¾“å…¥æ–‡æœ¬&quot;</span>
        <span class="p">)</span>
        <span class="n">document_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_area</span><span class="p">(</span><span class="s2">&quot;æˆ–ç›´æ¥è¾“å…¥åŸå§‹æ–‡æœ¬&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;æå–æœ¯è¯­å’Œå®šä¹‰&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">uploaded_file</span> <span class="ow">or</span> <span class="n">document_text</span>
        <span class="p">):</span>
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">terms_docs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;æå–ä¸­...&quot;</span><span class="p">):</span>
                <span class="n">terms_docs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">extract_terms</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">document_text</span><span class="p">)],</span>
                        <span class="n">term_extract_str</span><span class="p">,</span>
                        <span class="n">llm_name</span><span class="p">,</span>
                        <span class="n">model_temperature</span><span class="p">,</span>
                        <span class="n">api_key</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">terms_docs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;terms&quot;</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span> <span class="ow">and</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;å·²æå–æœ¯è¯­&quot;</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;æ’å…¥æœ¯è¯­ï¼Ÿ&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;æ’å…¥æœ¯è¯­ä¸­&quot;</span><span class="p">):</span>
                    <span class="n">insert_terms</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">])</span>
                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">])</span>
                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">st</span><span class="o">.</span><span class="n">experimental_rerun</span><span class="p">()</span>
</code></pre></div>
<p>ç°åœ¨ä½ å·²çœŸæ­£æŒæ¡ Streamlit çš„å¼ºå¤§åŠŸèƒ½ï¼ä»ä¸Šä¼ é€‰é¡¹å¡ä¸‹çš„ä»£ç å¼€å§‹ï¼šæˆ‘ä»¬æ·»åŠ äº†åˆå§‹åŒ–å‘é‡ç´¢å¼•çš„æŒ‰é’®ï¼Œå°†å…¶å­˜å‚¨åœ¨å…¨å±€ streamlit çŠ¶æ€å­—å…¸ä¸­ï¼Œå¹¶é‡ç½®å½“å‰æå–çš„æœ¯è¯­ã€‚æå–è¾“å…¥æ–‡æœ¬çš„æœ¯è¯­åï¼Œå†æ¬¡å°†å…¶å­˜å‚¨åœ¨å…¨å±€çŠ¶æ€ä¸­ï¼Œè®©ç”¨æˆ·åœ¨æ’å…¥å‰æœ‰æœºä¼šå®¡é˜…ã€‚å½“ç‚¹å‡»æ’å…¥æŒ‰é’®æ—¶ï¼Œè°ƒç”¨æ’å…¥æœ¯è¯­å‡½æ•°ï¼Œæ›´æ–°å…¨å±€è·Ÿè¸ªçš„å·²æ’å…¥æœ¯è¯­ï¼Œå¹¶ä»ä¼šè¯çŠ¶æ€ç§»é™¤æœ€è¿‘æå–çš„æœ¯è¯­ã€‚</p>
<h2 id="_5">æŸ¥è¯¢å·²æå–çš„æœ¯è¯­/å®šä¹‰<a class="headerlink" href="#_5" title="Permanent link">#</a></h2>
<p>å½“æœ¯è¯­å’Œå®šä¹‰è¢«æå–å¹¶ä¿å­˜åï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Ÿç”¨æˆ·åˆå¦‚ä½•è®°ä½ä¹‹å‰ä¿å­˜çš„å†…å®¹ï¼Ÿæˆ‘ä»¬åªéœ€åœ¨åº”ç”¨ä¸­æ·»åŠ å‡ ä¸ªæ ‡ç­¾é¡µå³å¯å®ç°è¿™äº›åŠŸèƒ½ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="n">setup_tab</span><span class="p">,</span> <span class="n">terms_tab</span><span class="p">,</span> <span class="n">upload_tab</span><span class="p">,</span> <span class="n">query_tab</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">tabs</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;Setup&quot;</span><span class="p">,</span> <span class="s2">&quot;All Terms&quot;</span><span class="p">,</span> <span class="s2">&quot;Upload/Extract Terms&quot;</span><span class="p">,</span> <span class="s2">&quot;Query Terms&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="o">...</span>
<span class="k">with</span> <span class="n">terms_tab</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">terms_tab</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;å½“å‰å·²æå–çš„æœ¯è¯­å’Œå®šä¹‰&quot;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">])</span>
<span class="o">...</span>
<span class="k">with</span> <span class="n">query_tab</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;æŸ¥è¯¢æœ¯è¯­/å®šä¹‰ï¼&quot;</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="s2">&quot;å¤§è¯­è¨€æ¨¡å‹å°†å°è¯•å›ç­”æ‚¨çš„æŸ¥è¯¢ï¼Œå¹¶ä½¿ç”¨æ‚¨æ’å…¥çš„æœ¯è¯­/å®šä¹‰æ¥å¢å¼ºå…¶å›ç­”ã€‚&quot;</span>
            <span class="s2">&quot;å¦‚æœç´¢å¼•ä¸­ä¸å­˜åœ¨è¯¥æœ¯è¯­ï¼Œæ¨¡å‹å°†åŸºäºå…¶å†…éƒ¨çŸ¥è¯†è¿›è¡Œå›ç­”ã€‚&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;åˆå§‹åŒ–ç´¢å¼•å¹¶é‡ç½®æœ¯è¯­&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;init_index_2&quot;</span><span class="p">):</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initialize_index</span><span class="p">(</span>
            <span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span>
        <span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="s2">&quot;llama_index&quot;</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
        <span class="n">query_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;è¾“å…¥è¦æŸ¥è¯¢çš„æœ¯è¯­æˆ–å®šä¹‰ï¼š&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query_text</span><span class="p">:</span>
            <span class="n">query_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">query_text</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">å¦‚æœæ‰¾ä¸åˆ°ç­”æ¡ˆï¼Œè¯·æ ¹æ®æ‚¨çš„æœ€ä½³çŸ¥è¯†å›ç­”è¯¥æŸ¥è¯¢ã€‚&quot;</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;ç”Ÿæˆå›ç­”ä¸­...&quot;</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
                        <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                        <span class="n">response_mode</span><span class="o">=</span><span class="s2">&quot;compact&quot;</span><span class="p">,</span>
                        <span class="n">text_qa_template</span><span class="o">=</span><span class="n">TEXT_QA_TEMPLATE</span><span class="p">,</span>
                        <span class="n">refine_template</span><span class="o">=</span><span class="n">DEFAULT_REFINE_PROMPT</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_text</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
</code></pre></div>
<p>è™½ç„¶è¿™ä¸»è¦æ˜¯åŸºç¡€åŠŸèƒ½ï¼Œä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>åˆå§‹åŒ–æŒ‰é’®ä¸å…¶ä»–æŒ‰é’®æ–‡å­—ç›¸åŒã€‚Streamlitä¼šå¯¹æ­¤å‘å‡ºè­¦å‘Šï¼Œå› æ­¤æˆ‘ä»¬æä¾›äº†å”¯ä¸€é”®å€¼ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆ</li>
<li>æŸ¥è¯¢ä¸­æ·»åŠ äº†é¢å¤–æ–‡æœ¬ï¼è¿™æ˜¯ä¸ºäº†åœ¨ç´¢å¼•ä¸­æ²¡æœ‰ç­”æ¡ˆæ—¶è¿›è¡Œè¡¥å¿</li>
<li>åœ¨ç´¢å¼•æŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸¤ä¸ªé€‰é¡¹ï¼š</li>
<li><code>similarity_top_k=5</code> è¡¨ç¤ºç´¢å¼•å°†è·å–ä¸æŸ¥è¯¢æœ€åŒ¹é…çš„å‰5ä¸ªæœ¯è¯­/å®šä¹‰</li>
<li><code>response_mode="compact"</code> è¡¨ç¤ºå°½å¯èƒ½å¤šçš„æ–‡æœ¬å°†ä»5ä¸ªåŒ¹é…çš„æœ¯è¯­/å®šä¹‰ä¸­ç”¨äºæ¯æ¬¡LLMè°ƒç”¨ã€‚è‹¥ä¸è®¾ç½®ï¼Œç´¢å¼•å°†è‡³å°‘è°ƒç”¨LLM 5æ¬¡ï¼Œè¿™ä¼šé™ä½ç”¨æˆ·ä½“éªŒ</li>
</ul>
<h2 id="_6">è¯•è¿è¡Œæµ‹è¯•<a class="headerlink" href="#_6" title="Permanent link">#</a></h2>
<p>å®é™…ä¸Šï¼Œæˆ‘å¸Œæœ›æ‚¨å·²ç»åœ¨æˆ‘ä»¬è¿›è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œäº†æµ‹è¯•ã€‚ä½†ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›è¡Œä¸€æ¬¡å®Œæ•´çš„æµ‹è¯•ã€‚</p>
<ol>
<li>åˆ·æ–°åº”ç”¨</li>
<li>è¾“å…¥æ‚¨çš„LLMè®¾ç½®</li>
<li>è½¬åˆ°æŸ¥è¯¢æ ‡ç­¾é¡µ</li>
<li>è¯¢é—®ä»¥ä¸‹å†…å®¹ï¼š<code>ä»€ä¹ˆæ˜¯bunnyhugï¼Ÿ</code></li>
<li>åº”ç”¨åº”è¯¥ä¼šç»™å‡ºä¸€äº›æ— æ„ä¹‰çš„å›ç­”ã€‚å¦‚æœæ‚¨ä¸çŸ¥é“ï¼Œbunnyhugæ˜¯åŠ æ‹¿å¤§è‰åŸåœ°åŒºäººä»¬å¯¹è¿å¸½è¡«çš„åˆ«ç§°ï¼</li>
<li>è®©æˆ‘ä»¬å°†è¿™ä¸ªå®šä¹‰æ·»åŠ åˆ°åº”ç”¨ä¸­ã€‚æ‰“å¼€ä¸Šä¼ æ ‡ç­¾é¡µå¹¶è¾“å…¥ä»¥ä¸‹æ–‡æœ¬ï¼š<code>bunnyhugæ˜¯ç”¨äºæè¿°è¿å¸½è¡«çš„å¸¸è§æœ¯è¯­ã€‚è¿™ä¸ªæœ¯è¯­è¢«åŠ æ‹¿å¤§è‰åŸåœ°åŒºçš„äººä»¬ä½¿ç”¨ã€‚</code></li>
<li>ç‚¹å‡»æå–æŒ‰é’®ã€‚ç‰‡åˆ»åï¼Œåº”ç”¨åº”æ˜¾ç¤ºæ­£ç¡®æå–çš„æœ¯è¯­/å®šä¹‰ã€‚ç‚¹å‡»æ’å…¥æœ¯è¯­æŒ‰é’®ä¿å­˜å®ƒï¼</li>
<li>å¦‚æœæˆ‘ä»¬æ‰“å¼€æœ¯è¯­æ ‡ç­¾é¡µï¼Œåº”è¯¥ä¼šæ˜¾ç¤ºåˆšåˆšæå–çš„æœ¯è¯­å’Œå®šä¹‰</li>
<li>è¿”å›æŸ¥è¯¢æ ‡ç­¾é¡µï¼Œå†æ¬¡è¯¢é—®ä»€ä¹ˆæ˜¯bunnyhugã€‚ç°åœ¨ç­”æ¡ˆåº”è¯¥æ˜¯æ­£ç¡®çš„ï¼</li>
</ol>
<h2 id="1-">æ”¹è¿›#1 - åˆ›å»ºåˆå§‹ç´¢å¼•<a class="headerlink" href="#1-" title="Permanent link">#</a></h2>
<p>åŸºç¡€åº”ç”¨è¿è¡Œåï¼Œæ„å»ºæœ‰ç”¨çš„ç´¢å¼•å¯èƒ½æ„Ÿè§‰å·¥ä½œé‡å¾ˆå¤§ã€‚å¦‚æœæˆ‘ä»¬ä¸ºç”¨æˆ·æä¾›æŸç§èµ·ç‚¹æ¥å±•ç¤ºåº”ç”¨çš„æŸ¥è¯¢èƒ½åŠ›å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åšåˆ°ï¼é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯¹åº”ç”¨åšä¸€ä¸ªå°æ”¹åŠ¨ï¼Œä½¿æ¯æ¬¡ä¸Šä¼ åå°†ç´¢å¼•ä¿å­˜åˆ°ç£ç›˜ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">insert_terms</span><span class="p">(</span><span class="n">terms_to_definition</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">definition</span> <span class="ow">in</span> <span class="n">terms_to_definition</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Term: </span><span class="si">{</span><span class="n">term</span><span class="si">}</span><span class="se">\n</span><span class="s2">Definition: </span><span class="si">{</span><span class="n">definition</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="c1"># ä¸´æ—¶ - ä¿å­˜åˆ°ç£ç›˜</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">storage_context</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
</code></pre></div>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æ–‡æ¡£æ¥æå–ï¼æœ¬é¡¹ç›®ä»“åº“ä½¿ç”¨äº†çº½çº¦å¸‚çš„ç»´åŸºç™¾ç§‘é¡µé¢ï¼Œæ‚¨å¯ä»¥åœ¨<a href="https://github.com/jerryjliu/llama_index/blob/main/examples/test_wiki/data/nyc_text.txt">è¿™é‡Œ</a>æ‰¾åˆ°æ–‡æœ¬ã€‚</p>
<p>å¦‚æœæ‚¨å°†æ–‡æœ¬ç²˜è´´åˆ°ä¸Šä¼ æ ‡ç­¾é¡µå¹¶è¿è¡Œï¼ˆå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ’å…¥æå–çš„æœ¯è¯­ã€‚åœ¨æ’å…¥ç´¢å¼•ä¹‹å‰ï¼Œè¯·åŠ¡å¿…å°†æå–çš„æœ¯è¯­æ–‡æœ¬å¤åˆ¶åˆ°è®°äº‹æœ¬æˆ–ç±»ä¼¼å·¥å…·ä¸­ï¼æˆ‘ä»¬ç¨åä¼šéœ€è¦å®ƒä»¬ã€‚</p>
<p>æ’å…¥åï¼Œåˆ é™¤æˆ‘ä»¬ç”¨äºå°†ç´¢å¼•ä¿å­˜åˆ°ç£ç›˜çš„é‚£è¡Œä»£ç ã€‚ç°åœ¨æœ‰äº†åˆå§‹ä¿å­˜çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä¿®æ”¹<code>initialize_index</code>å‡½æ•°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="nd">@st</span><span class="o">.</span><span class="n">cache_resource</span>
<span class="k">def</span> <span class="nf">initialize_index</span><span class="p">(</span><span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åŠ è½½ç´¢å¼•å¯¹è±¡ã€‚&quot;&quot;&quot;</span>
    <span class="n">Settings</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">get_llm</span><span class="p">(</span><span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">load_index_from_storage</span><span class="p">(</span><span class="n">storage_context</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">index</span>
</code></pre></div>
<p>æ‚¨è¿˜è®°å¾—åœ¨è®°äº‹æœ¬ä¸­ä¿å­˜é‚£ä¸ªå·¨å¤§çš„æå–æœ¯è¯­åˆ—è¡¨å—ï¼Ÿç°åœ¨å½“æˆ‘ä»¬çš„åº”ç”¨åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å°†ç´¢å¼•ä¸­çš„é»˜è®¤æœ¯è¯­ä¼ é€’åˆ°å…¨å±€æœ¯è¯­çŠ¶æ€ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="k">if</span> <span class="s2">&quot;all_terms&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TERMS</span>
<span class="o">...</span>
</code></pre></div>
<p>åœ¨æˆ‘ä»¬ä¹‹å‰é‡ç½®<code>all_terms</code>å€¼çš„ä»»ä½•åœ°æ–¹é‡å¤ä¸Šè¿°æ“ä½œã€‚</p>
<h2 id="2-">æ”¹è¿›#2 - ï¼ˆä¼˜åŒ–ï¼‰æ›´å¥½çš„æç¤ºè¯<a class="headerlink" href="#2-" title="Permanent link">#</a></h2>
<p>å¦‚æœæ‚¨ç°åœ¨ç¨å¾®ä½¿ç”¨ä¸€ä¸‹åº”ç”¨ï¼Œå¯èƒ½ä¼šæ³¨æ„åˆ°å®ƒä¸å†éµå¾ªæˆ‘ä»¬çš„æç¤ºè¯ï¼è®°ä½ï¼Œæˆ‘ä»¬åœ¨<code>query_str</code>å˜é‡ä¸­æ·»åŠ äº†å¦‚æœæ‰¾ä¸åˆ°æœ¯è¯­/å®šä¹‰ï¼Œå°±æ ¹æ®å…¶æœ€ä½³çŸ¥è¯†å›ç­”ã€‚ä½†ç°åœ¨å¦‚æœæ‚¨å°è¯•è¯¢é—®éšæœºæœ¯è¯­ï¼ˆå¦‚bunnyhugï¼ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šéµå¾ªè¿™äº›æŒ‡ä»¤ã€‚</p>
<p>è¿™æ˜¯ç”±äºLlama Indexä¸­"ä¼˜åŒ–"ç­”æ¡ˆçš„æ¦‚å¿µã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨æŸ¥è¯¢å‰5ä¸ªåŒ¹é…ç»“æœï¼Œæœ‰æ—¶æ‰€æœ‰ç»“æœæ— æ³•æ”¾å…¥å•ä¸ªæç¤ºä¸­ï¼OpenAIæ¨¡å‹é€šå¸¸æœ‰4097ä¸ªtokençš„æœ€å¤§è¾“å…¥å¤§å°ã€‚å› æ­¤ï¼ŒLlama Indexé€šè¿‡å°†åŒ¹é…ç»“æœåˆ†æˆé€‚åˆæç¤ºçš„å—æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚åœ¨Llama Indexä»ç¬¬ä¸€æ¬¡APIè°ƒç”¨è·å¾—åˆå§‹ç­”æ¡ˆåï¼Œå®ƒä¼šå°†ä¸‹ä¸€ä¸ªå—å‘é€ç»™APIï¼Œè¿åŒä¹‹å‰çš„ç­”æ¡ˆï¼Œå¹¶è¦æ±‚æ¨¡å‹ä¼˜åŒ–è¯¥ç­”æ¡ˆã€‚</p>
<p>å› æ­¤ï¼Œä¼˜åŒ–è¿‡ç¨‹ä¼¼ä¹å¹²æ‰°äº†æˆ‘ä»¬çš„ç»“æœï¼ä¸å…¶åœ¨<code>query_str</code>ä¸­é™„åŠ é¢å¤–æŒ‡ä»¤ï¼Œä¸å¦‚åˆ é™¤å®ƒï¼ŒLlama Indexå°†å…è®¸æˆ‘ä»¬æä¾›è‡ªå®šä¹‰æç¤ºè¯ï¼ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºè¿™äº›æç¤ºè¯ï¼Œä»¥<a href="https://github.com/run-llama/llama_index/blob/main/llama-index-core/llama_index/core/prompts/default_prompts.py">é»˜è®¤æç¤ºè¯</a>å’Œ<a href="https://github.com/run-llama/llama_index/blob/main/llama-index-core/llama_index/core/prompts/chat_prompts.py">èŠå¤©ç‰¹å®šæç¤ºè¯</a>ä¸ºæŒ‡å—ã€‚ä½¿ç”¨æ–°æ–‡ä»¶<code>constants.py</code>ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€äº›æ–°çš„æŸ¥è¯¢æ¨¡æ¿ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">llama_index.core</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PromptTemplate</span><span class="p">,</span>
    <span class="n">SelectorPromptTemplate</span><span class="p">,</span>
    <span class="n">ChatPromptTemplate</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">llama_index.core.prompts.utils</span> <span class="kn">import</span> <span class="n">is_chat_model</span>
<span class="kn">from</span> <span class="nn">llama_index.core.llms</span> <span class="kn">import</span> <span class="n">ChatMessage</span><span class="p">,</span> <span class="n">MessageRole</span>

<span class="c1"># æ–‡æœ¬é—®ç­”æ¨¡æ¿</span>
<span class="n">DEFAULT_TEXT_QA_PROMPT_TMPL</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;ä¸Šä¸‹æ–‡ä¿¡æ¯å¦‚ä¸‹ã€‚</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;---------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;</span><span class="si">{context_str}</span><span class="s2">&quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;æ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”ä»¥ä¸‹é—®é¢˜&quot;</span>
    <span class="s2">&quot;(å¦‚æœä¸çŸ¥é“ç­”æ¡ˆï¼Œè¯·æ ¹æ®æ‚¨çš„æœ€ä½³çŸ¥è¯†å›ç­”)ï¼š</span><span class="si">{query_str}</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">TEXT_QA_TEMPLATE</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span><span class="n">DEFAULT_TEXT_QA_PROMPT_TMPL</span><span class="p">)</span>

<span class="c1"># ä¼˜åŒ–æ¨¡æ¿</span>
<span class="n">DEFAULT_REFINE_PROMPT_TMPL</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;åŸå§‹é—®é¢˜å¦‚ä¸‹ï¼š</span><span class="si">{query_str}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;æˆ‘ä»¬å·²æä¾›ä¸€ä¸ªç°æœ‰ç­”æ¡ˆï¼š</span><span class="si">{existing_answer}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;æˆ‘ä»¬æœ‰æœºä¼šç”¨ä»¥ä¸‹æ›´å¤šä¸Šä¸‹æ–‡æ¥ä¼˜åŒ–ç°æœ‰ç­”æ¡ˆ&quot;</span>
    <span class="s2">&quot;(ä»…åœ¨éœ€è¦æ—¶)ã€‚</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;------------</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;</span><span class="si">{context_msg}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;------------</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;æ ¹æ®æ–°ä¸Šä¸‹æ–‡å¹¶ä½¿ç”¨æ‚¨çš„æœ€ä½³çŸ¥è¯†ï¼Œæ”¹è¿›ç°æœ‰ç­”æ¡ˆã€‚&quot;</span>
    <span class="s2">&quot;å¦‚æœæ— æ³•æ”¹è¿›ç°æœ‰ç­”æ¡ˆï¼Œåªéœ€é‡å¤å®ƒã€‚&quot;</span>
<span class="p">)</span>
<span class="n">DEFAULT_REFINE_PROMPT</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span><span class="n">DEFAULT_REFINE_PROMPT_TMPL</span><span class="p">)</span>

<span class="n">CHAT_REFINE_PROMPT_TMPL_MSGS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ChatMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{query_str}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">MessageRole</span><span class="o">.</span><span class="n">USER</span><span class="p">),</span>
    <span class="n">ChatMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{existing_answer}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">MessageRole</span><span class="o">.</span><span class="n">ASSISTANT</span><span class="p">),</span>
    <span class="n">ChatMessage</span><span class="p">(</span>
        <span class="n">content</span><span class="o">=</span><span class="s2">&quot;æˆ‘ä»¬æœ‰æœºä¼šç”¨ä»¥ä¸‹æ›´å¤šä¸Šä¸‹æ–‡æ¥ä¼˜åŒ–ä¸Šè¿°ç­”æ¡ˆ&quot;</span>
        <span class="s2">&quot;(ä»…åœ¨éœ€è¦æ—¶)ã€‚</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="si">{context_msg}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;æ ¹æ®æ–°ä¸Šä¸‹æ–‡å¹¶ä½¿ç”¨æ‚¨çš„æœ€ä½³çŸ¥è¯†ï¼Œæ”¹è¿›ç°æœ‰ç­”æ¡ˆã€‚&quot;</span>
        <span class="s2">&quot;å¦‚æœæ— æ³•æ”¹è¿›ç°æœ‰ç­”æ¡ˆï¼Œåªéœ€é‡å¤å®ƒã€‚&quot;</span><span class="p">,</span>
        <span class="n">role</span><span class="o">=</span><span class="n">MessageRole</span><span class="o">.</span><span class="n">USER</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">]</span>

<span class="n">CHAT_REFINE_PROMPT</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span><span class="n">CHAT_REFINE_PROMPT_TMPL_MSGS</span><span class="p">)</span>

<span class="c1"># ä¼˜åŒ–æç¤ºè¯é€‰æ‹©å™¨</span>
<span class="n">REFINE_TEMPLATE</span> <span class="o">=</span> <span class="n">SelectorPromptTemplate</span><span class="p">(</span>
    <span class="n">default_template</span><span class="o">=</span><span class="n">DEFAULT_REFINE_PROMPT</span><span class="p">,</span>
    <span class="n">conditionals</span><span class="o">=</span><span class="p">[(</span><span class="n">is_chat_model</span><span class="p">,</span> <span class="n">CHAT_REFINE_PROMPT</span><span class="p">)],</span>
<span class="p">)</span>
</code></pre></div>
<p>çœ‹èµ·æ¥ä»£ç å¾ˆå¤šï¼Œä½†å…¶å®å¹¶ä¸å¤æ‚ï¼å¦‚æœæ‚¨æŸ¥çœ‹äº†é»˜è®¤æç¤ºè¯ï¼Œå¯èƒ½å·²ç»æ³¨æ„åˆ°æœ‰é»˜è®¤æç¤ºè¯å’Œç‰¹å®šäºèŠå¤©æ¨¡å‹çš„æç¤ºè¯ã€‚å»¶ç»­è¿™ä¸€è¶‹åŠ¿ï¼Œæˆ‘ä»¬ä¸ºè‡ªå®šä¹‰æç¤ºè¯ä¹Ÿåšäº†åŒæ ·å¤„ç†ã€‚ç„¶åï¼Œä½¿ç”¨æç¤ºè¯é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸¤ä¸ªæç¤ºè¯åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœä½¿ç”¨çš„LLMæ˜¯èŠå¤©æ¨¡å‹ï¼ˆChatGPTã€GPT-4ï¼‰ï¼Œåˆ™ä½¿ç”¨èŠå¤©æç¤ºè¯ã€‚å¦åˆ™ï¼Œä½¿ç”¨æ™®é€šæç¤ºè¯æ¨¡æ¿ã€‚</p>
<p>å¦ä¸€ä»¶éœ€è¦æ³¨æ„çš„äº‹æ˜¯æˆ‘ä»¬åªå®šä¹‰äº†ä¸€ä¸ªQAæ¨¡æ¿ã€‚åœ¨èŠå¤©æ¨¡å‹ä¸­ï¼Œè¿™å°†è½¬æ¢ä¸ºå•ä¸€çš„"äººç±»"æ¶ˆæ¯ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æç¤ºè¯å¯¼å…¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œå¹¶åœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨å®ƒä»¬ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">constants</span> <span class="kn">import</span> <span class="n">REFINE_TEMPLATE</span><span class="p">,</span> <span class="n">TEXT_QA_TEMPLATE</span>

<span class="o">...</span>
<span class="k">if</span> <span class="s2">&quot;llama_index&quot;</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">query_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;è¯¢é—®æœ¯è¯­æˆ–å®šä¹‰ï¼š&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">query_text</span><span class="p">:</span>
        <span class="n">query_text</span> <span class="o">=</span> <span class="n">query_text</span>  <span class="c1"># æ³¨æ„æˆ‘ä»¬ç§»é™¤äº†æ—§æŒ‡ä»¤</span>
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;ç”Ÿæˆå›ç­”ä¸­...&quot;</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
                    <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                    <span class="n">response_mode</span><span class="o">=</span><span class="s2">&quot;compact&quot;</span><span class="p">,</span>
                    <span class="n">text_qa_template</span><span class="o">=</span><span class="n">TEXT_QA_TEMPLATE</span><span class="p">,</span>
                    <span class="n">refine_template</span><span class="o">=</span><span class="n">DEFAULT_REFINE_PROMPT</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_text</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
<span class="o">...</span>
</code></pre></div>
<p>å¦‚æœæ‚¨å†å¤šå°è¯•ä¸€äº›æŸ¥è¯¢ï¼Œå¸Œæœ›æ‚¨èƒ½æ³¨æ„åˆ°ç°åœ¨çš„å›ç­”æ›´ç¬¦åˆæˆ‘ä»¬çš„æŒ‡ä»¤äº†ï¼</p>
<h2 id="3-">æ”¹è¿› #3 - å›¾åƒæ”¯æŒ<a class="headerlink" href="#3-" title="Permanent link">#</a></h2>
<p>Llama index è¿˜æ”¯æŒå›¾åƒå¤„ç†ï¼é€šè¿‡ Llama Indexï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ æ–‡æ¡£å›¾åƒï¼ˆè®ºæ–‡ã€ä¿¡ä»¶ç­‰ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æå–å…¶ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£å›¾ç‰‡å¹¶ä»ä¸­æå–æœ¯è¯­åŠå…¶å®šä¹‰ã€‚</p>
<p>å¦‚æœé‡åˆ° PIL å¯¼å…¥é”™è¯¯ï¼Œè¯·å…ˆæ‰§è¡Œ <code>pip install Pillow</code> å®‰è£…ä¾èµ–ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">llama_index.readers.file</span> <span class="kn">import</span> <span class="n">ImageReader</span>


<span class="nd">@st</span><span class="o">.</span><span class="n">cache_resource</span>
<span class="k">def</span> <span class="nf">get_file_extractor</span><span class="p">():</span>
    <span class="n">image_parser</span> <span class="o">=</span> <span class="n">ImageReader</span><span class="p">(</span><span class="n">keep_image</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parse_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file_extractor</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.jpg&quot;</span><span class="p">:</span> <span class="n">image_parser</span><span class="p">,</span>
        <span class="s2">&quot;.png&quot;</span><span class="p">:</span> <span class="n">image_parser</span><span class="p">,</span>
        <span class="s2">&quot;.jpeg&quot;</span><span class="p">:</span> <span class="n">image_parser</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">file_extractor</span>


<span class="n">file_extractor</span> <span class="o">=</span> <span class="n">get_file_extractor</span><span class="p">()</span>
<span class="o">...</span>
<span class="k">with</span> <span class="n">upload_tab</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Extract and Query Definitions&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Initialize Index and Reset Terms&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;init_index_1&quot;</span><span class="p">):</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;llama_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initialize_index</span><span class="p">(</span>
            <span class="n">llm_name</span><span class="p">,</span> <span class="n">model_temperature</span><span class="p">,</span> <span class="n">api_key</span>
        <span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_TERMS</span>

    <span class="k">if</span> <span class="s2">&quot;llama_index&quot;</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
            <span class="s2">&quot;Either upload an image/screenshot of a document, or enter the text manually.&quot;</span>
        <span class="p">)</span>
        <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">file_uploader</span><span class="p">(</span>
            <span class="s2">&quot;Upload an image/screenshot of a document:&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">document_text</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_area</span><span class="p">(</span><span class="s2">&quot;Or enter raw text&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Extract Terms and Definitions&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">uploaded_file</span> <span class="ow">or</span> <span class="n">document_text</span>
        <span class="p">):</span>
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">terms_docs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;Extracting (images may be slow)...&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">document_text</span><span class="p">:</span>
                    <span class="n">terms_docs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">extract_terms</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">document_text</span><span class="p">)],</span>
                            <span class="n">term_extract_str</span><span class="p">,</span>
                            <span class="n">llm_name</span><span class="p">,</span>
                            <span class="n">model_temperature</span><span class="p">,</span>
                            <span class="n">api_key</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">uploaded_file</span><span class="p">:</span>
                    <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;temp.png&quot;</span><span class="p">)</span>
                    <span class="n">img_reader</span> <span class="o">=</span> <span class="n">SimpleDirectoryReader</span><span class="p">(</span>
                        <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;temp.png&quot;</span><span class="p">],</span> <span class="n">file_extractor</span><span class="o">=</span><span class="n">file_extractor</span>
                    <span class="p">)</span>
                    <span class="n">img_docs</span> <span class="o">=</span> <span class="n">img_reader</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;temp.png&quot;</span><span class="p">)</span>
                    <span class="n">terms_docs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">extract_terms</span><span class="p">(</span>
                            <span class="n">img_docs</span><span class="p">,</span>
                            <span class="n">term_extract_str</span><span class="p">,</span>
                            <span class="n">llm_name</span><span class="p">,</span>
                            <span class="n">model_temperature</span><span class="p">,</span>
                            <span class="n">api_key</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">terms_docs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;terms&quot;</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span> <span class="ow">and</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;Extracted terms&quot;</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Insert terms?&quot;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">&quot;Inserting terms&quot;</span><span class="p">):</span>
                    <span class="n">insert_terms</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">])</span>
                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;all_terms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">])</span>
                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">[</span><span class="s2">&quot;terms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">st</span><span class="o">.</span><span class="n">experimental_rerun</span><span class="p">()</span>
</code></pre></div>
<p>åœ¨æ­¤æˆ‘ä»¬é€šè¿‡ Streamlit æ·»åŠ äº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚å›¾åƒæ–‡ä»¶ä¼šè¢«æ‰“å¼€å¹¶ä¿å­˜åˆ°ç£ç›˜ï¼ˆè™½ç„¶è¿™ç§æ–¹å¼ç•¥æ˜¾ç²—ç³™ï¼Œä½†ä¿æŒäº†ä»£ç ç®€æ´æ€§ï¼‰ã€‚éšåå°†å›¾åƒè·¯å¾„ä¼ é€’ç»™é˜…è¯»å™¨ï¼Œæå–æ–‡æ¡£/æ–‡æœ¬å†…å®¹ï¼Œæœ€ååˆ é™¤ä¸´æ—¶å›¾åƒæ–‡ä»¶ã€‚</p>
<p>è·å–æ–‡æ¡£åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒä¹‹å‰ä¸€æ ·è°ƒç”¨ <code>extract_terms()</code> å‡½æ•°ã€‚</p>
<h2 id="_7">æ€»ç»“/å†…å®¹æè¦<a class="headerlink" href="#_7" title="Permanent link">#</a></h2>
<p>æœ¬æ•™ç¨‹æ¶µç›–äº†å¤§é‡å®ç”¨ä¿¡æ¯ï¼Œå¹¶è§£å†³äº†è‹¥å¹²å¸¸è§é—®é¢˜ï¼š</p>
<ul>
<li>é’ˆå¯¹ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒç±»å‹çš„ç´¢å¼•ï¼ˆåˆ—è¡¨ç´¢å¼• vs å‘é‡ç´¢å¼•ï¼‰</li>
<li>ä½¿ç”¨ Streamlit çš„ <code>session_state</code> æœºåˆ¶å­˜å‚¨å…¨å±€çŠ¶æ€å€¼</li>
<li>è‡ªå®šä¹‰ Llama Index çš„å†…éƒ¨æç¤ºè¯</li>
<li>é€šè¿‡ Llama Index å®ç°å›¾åƒæ–‡æœ¬æå–</li>
</ul>
<p>å®Œæ•´æ•™ç¨‹ä»£ç å¯è®¿é—®<a href="https://github.com/abdulasiraj/A-Guide-to-Extracting-Terms-and-Definitions">GitHubä»“åº“</a>ï¼Œå®æ—¶æ¼”ç¤ºç‰ˆå¯åœ¨<a href="https://huggingface.co/spaces/Nobody4591/Llama_Index_Term_Extractor">Huggingface Spaces</a>ä½“éªŒã€‚</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
       
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: é—®ç­”æ¨¡å¼">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                é—®ç­”æ¨¡å¼
              </div>
            </div>
          </a>
        
        
          
          <a href="../../chatbots/building_a_chatbot/" class="md-footer__link md-footer__link--next" aria-label="Next: å¦‚ä½•æ„å»ºèŠå¤©æœºå™¨äºº">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                å¦‚ä½•æ„å»ºèŠå¤©æœºå™¨äºº
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <readthedocs-flyout position="bottom-left"></readthedocs-flyout>
      
    </div>
  </div>
</footer>
      
<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-WWRFB36R");
</script>
<!-- End Google Tag Manager -->

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.prune", "navigation.tabs", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "content.code.copy", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../../javascript/runllm.js"></script>
      
        <script src="../../../../javascript/algolia.js"></script>
      
    
  </body>
</html>