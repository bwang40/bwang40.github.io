
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.llamaindex.ai/en/stable/api_reference/callbacks/wandb/">
      
      
        <link rel="prev" href="../uptrain/">
      
      
        <link rel="next" href="../../chat_engines/condense_plus_context/">
      
      
      <link rel="icon" href="../../../_static/assets/LlamaLogoBrowserTab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Wandb - LlamaIndex</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/style.css">
    
      <link rel="stylesheet" href="../../../css/algolia.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-BYVB1ZVE6J"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-BYVB1ZVE6J",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-BYVB1ZVE6J",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#llama_index.callbacks.wandb.WandbCallbackHandler" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="LlamaIndex" class="md-header__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LlamaIndex
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Wandb
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      

<!-- Search interface -->
<div id="docsearch"></div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../understanding/" class="md-tabs__link">
          
  
    
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../use_cases/" class="md-tabs__link">
          
  
    
  
  Use Cases

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../module_guides/" class="md-tabs__link">
          
  
    
  
  Component Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../optimizing/production_rag/" class="md-tabs__link">
          
  
    
  
  Advanced Topics

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../community/integrations/" class="md-tabs__link">
          
  
    
  
  Open-Source Community

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://docs.cloud.llamaindex.ai/" class="md-tabs__link">
        
  
    
  
  LlamaCloud

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="LlamaIndex" class="md-nav__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    LlamaIndex
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../.." class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Home
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../understanding/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../use_cases/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Use Cases
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../examples/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../module_guides/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Component Guides
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../optimizing/production_rag/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Advanced Topics
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../agent/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Agents
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Callbacks
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Callbacks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agentops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agentops
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../argilla/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Argilla
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arize_phoenix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arize phoenix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deepeval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deepeval
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../honeyhive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Honeyhive
  </span>
  

      </a>
    </li>
  

              
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../langfuse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Langfuse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../literalai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Literalai
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../llama_debug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llama debug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openinference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Openinference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opentelemetry.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opik/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Opik
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../promptlayer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Promptlayer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../token_counter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Token counter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uptrain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Uptrain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Wandb
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Wandb
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler" class="md-nav__link">
    <span class="md-ellipsis">
      WandbCallbackHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WandbCallbackHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_start" class="md-nav__link">
    <span class="md-ellipsis">
      on_event_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_end" class="md-nav__link">
    <span class="md-ellipsis">
      on_event_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.start_trace" class="md-nav__link">
    <span class="md-ellipsis">
      start_trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.log_trace_tree" class="md-nav__link">
    <span class="md-ellipsis">
      log_trace_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.persist_index" class="md-nav__link">
    <span class="md-ellipsis">
      persist_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.load_storage_context" class="md-nav__link">
    <span class="md-ellipsis">
      load_storage_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.finish" class="md-nav__link">
    <span class="md-ellipsis">
      finish
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agentops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agentops
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../argilla/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Argilla
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arize_phoenix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arize phoenix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deepeval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deepeval
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../honeyhive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Honeyhive
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../langfuse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Langfuse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../literalai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Literalai
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openinference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Openinference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opik/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Opik
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../promptlayer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Promptlayer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uptrain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Uptrain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Wandb
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Wandb
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler" class="md-nav__link">
    <span class="md-ellipsis">
      WandbCallbackHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WandbCallbackHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_start" class="md-nav__link">
    <span class="md-ellipsis">
      on_event_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_end" class="md-nav__link">
    <span class="md-ellipsis">
      on_event_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.start_trace" class="md-nav__link">
    <span class="md-ellipsis">
      start_trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.log_trace_tree" class="md-nav__link">
    <span class="md-ellipsis">
      log_trace_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.persist_index" class="md-nav__link">
    <span class="md-ellipsis">
      persist_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.load_storage_context" class="md-nav__link">
    <span class="md-ellipsis">
      load_storage_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.finish" class="md-nav__link">
    <span class="md-ellipsis">
      finish
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../chat_engines/condense_plus_context/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Chat Engines
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../embeddings/adapter/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Embeddings
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../evaluation/answer_relevancy/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Evaluation
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../graph_rag/cognee/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Graph RAG
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../indices/bge_m3/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Indexes
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../ingestion/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Ingestion
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../instrumentation/event_handlers/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Instrumentation
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../llms/ai21/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    LLMs
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../llama_dataset/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Llama Datasets
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../llama_deploy" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Llama Deploy
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../packs/agent_search_retriever/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Llama Packs
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../llama_deploy/apiserver.md" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    LlamaDeploy
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../memory/chat_memory_buffer/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Memory
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../llama_deploy/message_queues/index.md" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Message Queues
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../extractors/documentcontext/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Metadata Extractors
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../multi_modal_llms/anthropic/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Multi-Modal LLMs
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../node_parser/alibabacloud_aisearch/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Node Parsers & Text Splitters
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../postprocessor/NER_PII/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Node Postprocessors
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../objects/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Object Stores
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../observability/otel/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Observability
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../output_parsers/guardrails/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Output Parsers
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../program/evaporate/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Programs
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../prompts/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Prompts
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../protocols/ag_ui/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Protocols
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../query_engine/FLARE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Query Engines
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../query_pipeline/agent/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Query Pipeline
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../question_gen/guidance/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Question Generators
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../readers/agent_search/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Readers
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../response_synthesizers/accumulate/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Response Synthesizers
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../retrievers/auto_merging/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Retrievers
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../schema/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Schema
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../selectors/notdiamond/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Selectors
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../sparse_embeddings/fastembed/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Sparse Embeddings
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../storage/chat_store/async_sql/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../tools/agentql/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Tools
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../voice_agents/elevenlabs/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Voice Agents
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../workflow/decorators/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Workflow
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../community/integrations/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Open-Source Community
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.cloud.llamaindex.ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LlamaCloud
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler" class="md-nav__link">
    <span class="md-ellipsis">
      WandbCallbackHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WandbCallbackHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_start" class="md-nav__link">
    <span class="md-ellipsis">
      on_event_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_end" class="md-nav__link">
    <span class="md-ellipsis">
      on_event_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.start_trace" class="md-nav__link">
    <span class="md-ellipsis">
      start_trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.log_trace_tree" class="md-nav__link">
    <span class="md-ellipsis">
      log_trace_tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.persist_index" class="md-nav__link">
    <span class="md-ellipsis">
      persist_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.load_storage_context" class="md-nav__link">
    <span class="md-ellipsis">
      load_storage_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_index.callbacks.wandb.WandbCallbackHandler.finish" class="md-nav__link">
    <span class="md-ellipsis">
      finish
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Wandb</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="llama_index.callbacks.wandb.WandbCallbackHandler" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">WandbCallbackHandler</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="llama_index.core.callbacks.base_handler.BaseCallbackHandler" href="../#llama_index.core.callbacks.base_handler.BaseCallbackHandler">BaseCallbackHandler</a></code></p>


        <p>Callback handler that logs events to wandb.</p>
<p>NOTE: this is a beta feature. The usage within our codebase, and the interface
may change.</p>
<p>Use the <code>WandbCallbackHandler</code> to log trace events to wandb. This handler is
useful for debugging and visualizing the trace events. It captures the payload of
the events and logs them to wandb. The handler also tracks the start and end of
events. This is particularly useful for debugging your LLM calls.</p>
<p>The <code>WandbCallbackHandler</code> can also be used to log the indices and graphs to wandb
using the <code>persist_index</code> method. This will save the indexes as artifacts in wandb.
The <code>load_storage_context</code> method can be used to load the indexes from wandb
artifacts. This method will return a <code>StorageContext</code> object that can be used to
build the index, using <code>load_index_from_storage</code>, <code>load_indices_from_storage</code> or
<code>load_graph_from_storage</code> functions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>event_starts_to_ignore</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="llama_index.core.callbacks.schema.CBEventType" href="../#llama_index.core.callbacks.schema.CBEventType">CBEventType</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of event types to
ignore when tracking event starts.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>event_ends_to_ignore</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="llama_index.core.callbacks.schema.CBEventType" href="../#llama_index.core.callbacks.schema.CBEventType">CBEventType</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of event types to
ignore when tracking event ends.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WandbCallbackHandler</span><span class="p">(</span><span class="n">BaseCallbackHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback handler that logs events to wandb.</span>

<span class="sd">    NOTE: this is a beta feature. The usage within our codebase, and the interface</span>
<span class="sd">    may change.</span>

<span class="sd">    Use the `WandbCallbackHandler` to log trace events to wandb. This handler is</span>
<span class="sd">    useful for debugging and visualizing the trace events. It captures the payload of</span>
<span class="sd">    the events and logs them to wandb. The handler also tracks the start and end of</span>
<span class="sd">    events. This is particularly useful for debugging your LLM calls.</span>

<span class="sd">    The `WandbCallbackHandler` can also be used to log the indices and graphs to wandb</span>
<span class="sd">    using the `persist_index` method. This will save the indexes as artifacts in wandb.</span>
<span class="sd">    The `load_storage_context` method can be used to load the indexes from wandb</span>
<span class="sd">    artifacts. This method will return a `StorageContext` object that can be used to</span>
<span class="sd">    build the index, using `load_index_from_storage`, `load_indices_from_storage` or</span>
<span class="sd">    `load_graph_from_storage` functions.</span>


<span class="sd">    Args:</span>
<span class="sd">        event_starts_to_ignore (Optional[List[CBEventType]]): list of event types to</span>
<span class="sd">            ignore when tracking event starts.</span>
<span class="sd">        event_ends_to_ignore (Optional[List[CBEventType]]): list of event types to</span>
<span class="sd">            ignore when tracking event ends.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">run_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WandbRunArgs</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">event_starts_to_ignore</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CBEventType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">event_ends_to_ignore</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CBEventType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wandb</span>
            <span class="kn">from</span> <span class="nn">wandb.sdk.data_types</span> <span class="kn">import</span> <span class="n">trace_tree</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span> <span class="o">=</span> <span class="n">wandb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span> <span class="o">=</span> <span class="n">trace_tree</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;WandbCallbackHandler requires wandb. &quot;</span>
                <span class="s2">&quot;Please install it with `pip install wandb`.&quot;</span>
            <span class="p">)</span>

        <span class="kn">from</span> <span class="nn">llama_index.core.indices</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">ComposableGraph</span><span class="p">,</span>
            <span class="n">GPTEmptyIndex</span><span class="p">,</span>
            <span class="n">GPTKeywordTableIndex</span><span class="p">,</span>
            <span class="n">GPTRAKEKeywordTableIndex</span><span class="p">,</span>
            <span class="n">GPTSimpleKeywordTableIndex</span><span class="p">,</span>
            <span class="n">GPTSQLStructStoreIndex</span><span class="p">,</span>
            <span class="n">GPTTreeIndex</span><span class="p">,</span>
            <span class="n">GPTVectorStoreIndex</span><span class="p">,</span>
            <span class="n">SummaryIndex</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_IndexType</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ComposableGraph</span><span class="p">,</span>
            <span class="n">GPTKeywordTableIndex</span><span class="p">,</span>
            <span class="n">GPTSimpleKeywordTableIndex</span><span class="p">,</span>
            <span class="n">GPTRAKEKeywordTableIndex</span><span class="p">,</span>
            <span class="n">SummaryIndex</span><span class="p">,</span>
            <span class="n">GPTEmptyIndex</span><span class="p">,</span>
            <span class="n">GPTTreeIndex</span><span class="p">,</span>
            <span class="n">GPTVectorStoreIndex</span><span class="p">,</span>
            <span class="n">GPTSQLStructStoreIndex</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_run_args</span> <span class="o">=</span> <span class="n">run_args</span>
        <span class="c1"># Check if a W&amp;B run is already initialized; if not, initialize one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_run</span><span class="p">(</span><span class="n">should_print_url</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span>  <span class="c1"># type: ignore[attr-defined]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cur_trace_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span> <span class="ow">or</span> <span class="n">get_tokenizer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_counter</span> <span class="o">=</span> <span class="n">TokenCounter</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">)</span>

        <span class="n">event_starts_to_ignore</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">event_starts_to_ignore</span> <span class="k">if</span> <span class="n">event_starts_to_ignore</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="p">)</span>
        <span class="n">event_ends_to_ignore</span> <span class="o">=</span> <span class="n">event_ends_to_ignore</span> <span class="k">if</span> <span class="n">event_ends_to_ignore</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">event_starts_to_ignore</span><span class="o">=</span><span class="n">event_starts_to_ignore</span><span class="p">,</span>
            <span class="n">event_ends_to_ignore</span><span class="o">=</span><span class="n">event_ends_to_ignore</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_event_start</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_type</span><span class="p">:</span> <span class="n">CBEventType</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store event start data by event type.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_type (CBEventType): event type to store.</span>
<span class="sd">            payload (Optional[Dict[str, Any]]): payload to store.</span>
<span class="sd">            event_id (str): event id to store.</span>
<span class="sd">            parent_id (str): parent event id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">CBEvent</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">id_</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">id_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">id_</span>

    <span class="k">def</span> <span class="nf">on_event_end</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_type</span><span class="p">:</span> <span class="n">CBEventType</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store event end data by event type.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_type (CBEventType): event type to store.</span>
<span class="sd">            payload (Optional[Dict[str, Any]]): payload to store.</span>
<span class="sd">            event_id (str): event id to store.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">CBEvent</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">id_</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">id_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Launch a trace.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cur_trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">end_trace</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trace_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trace_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Ensure W&amp;B run is initialized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_run</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span> <span class="o">=</span> <span class="n">trace_map</span> <span class="ow">or</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Log the trace map to wandb</span>
        <span class="c1"># We can control what trace ids we want to log here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_trace_tree</span><span class="p">()</span>

        <span class="c1"># TODO (ayulockin): Log the LLM token counts to wandb when weave is ready</span>

    <span class="k">def</span> <span class="nf">log_trace_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log the trace tree to wandb.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">child_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">]</span>
            <span class="n">root_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_event_pair_to_wb_span</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">[</span><span class="n">child_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                <span class="n">trace_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cur_trace_id</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">child_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span><span class="p">[</span><span class="n">child_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">root_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_trace_tree</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">,</span> <span class="n">root_span</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">root_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_trace_tree</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">,</span> <span class="n">root_span</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">root_span</span><span class="p">:</span>
                <span class="n">root_trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">WBTraceTree</span><span class="p">(</span><span class="n">root_span</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="n">root_trace</span><span class="p">})</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">termlog</span><span class="p">(</span><span class="s2">&quot;Logged trace tree to W&amp;B.&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to log trace tree to W&amp;B: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># ignore errors to not break user code</span>

    <span class="k">def</span> <span class="nf">persist_index</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="s2">&quot;IndexType&quot;</span><span class="p">,</span> <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">persist_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload an index to wandb as an artifact. You can learn more about W&amp;B</span>
<span class="sd">        artifacts here: https://docs.wandb.ai/guides/artifacts.</span>

<span class="sd">        For the `ComposableGraph` index, the root id is stored as artifact metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            index (IndexType): index to upload.</span>
<span class="sd">            index_name (str): name of the index. This will be used as the artifact name.</span>
<span class="sd">            persist_dir (Union[str, None]): directory to persist the index. If None, a</span>
<span class="sd">                temporary directory will be created and used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">persist_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">persist_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">/storage&quot;</span>  <span class="c1"># type: ignore</span>
            <span class="n">_default_persist_dir</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IndexType</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span><span class="o">.</span><span class="n">storage_context</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

                <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># For the `ComposableGraph` index, store the root id as metadata</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IndexType</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">root_id</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">root_id</span>
                    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;root_id&quot;</span><span class="p">:</span> <span class="n">root_id</span><span class="p">}</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_upload_index_as_wb_artifact</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">,</span> <span class="n">index_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Silently ignore errors to not break user code</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print_upload_index_fail_message</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># clear the default storage dir</span>
        <span class="k">if</span> <span class="n">_default_persist_dir</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_storage_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">artifact_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index_download_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StorageContext&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download an index from wandb and return a storage context.</span>

<span class="sd">        Use this storage context to load the index into memory using</span>
<span class="sd">        `load_index_from_storage`, `load_indices_from_storage` or</span>
<span class="sd">        `load_graph_from_storage` functions.</span>

<span class="sd">        Args:</span>
<span class="sd">            artifact_url (str): url of the artifact to download. The artifact url will</span>
<span class="sd">                be of the form: `entity/project/index_name:version` and can be found in</span>
<span class="sd">                the W&amp;B UI.</span>
<span class="sd">            index_download_dir (Union[str, None]): directory to download the index to.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">llama_index.core.storage.storage_context</span> <span class="kn">import</span> <span class="n">StorageContext</span>

        <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">use_artifact</span><span class="p">(</span><span class="n">artifact_url</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;storage_context&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="n">artifact_dir</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">index_download_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">StorageContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="n">artifact_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_upload_index_as_wb_artifact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">artifact_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Utility function to upload a dir to W&amp;B as an artifact.&quot;&quot;&quot;</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">(</span><span class="n">artifact_name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;storage_context&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>

        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">artifact</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="n">artifact</span><span class="o">.</span><span class="n">add_dir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">_build_trace_tree</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">span</span><span class="p">:</span> <span class="s2">&quot;trace_tree.Span&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;trace_tree.Span&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the trace tree from the trace map.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child_event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">child_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_event_pair_to_wb_span</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">[</span><span class="n">child_event</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">child_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_trace_tree</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span><span class="p">[</span><span class="n">child_event</span><span class="p">],</span> <span class="n">child_span</span>
            <span class="p">)</span>
            <span class="n">span</span><span class="o">.</span><span class="n">add_child_span</span><span class="p">(</span><span class="n">child_span</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">span</span>

    <span class="k">def</span> <span class="nf">_convert_event_pair_to_wb_span</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_pair</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">],</span>
        <span class="n">trace_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;trace_tree.Span&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a pair of events to a wandb trace tree span.&quot;&quot;&quot;</span>
        <span class="n">start_time_ms</span><span class="p">,</span> <span class="n">end_time_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_time_in_ms</span><span class="p">(</span><span class="n">event_pair</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trace_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">event_type</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_event_type_to_span_kind</span><span class="p">(</span><span class="n">event_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="n">trace_id</span>  <span class="c1"># type: ignore</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">wb_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">Span</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">span_kind</span><span class="o">=</span><span class="n">span_kind</span><span class="p">,</span>
            <span class="n">start_time_ms</span><span class="o">=</span><span class="n">start_time_ms</span><span class="p">,</span>
            <span class="n">end_time_ms</span><span class="o">=</span><span class="n">end_time_ms</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">wb_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_payload_to_span</span><span class="p">(</span><span class="n">wb_span</span><span class="p">,</span> <span class="n">event_pair</span><span class="p">)</span>
        <span class="n">wb_span</span><span class="o">.</span><span class="n">add_named_result</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">return</span> <span class="n">wb_span</span>

    <span class="k">def</span> <span class="nf">_map_event_type_to_span_kind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="n">CBEventType</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;trace_tree.SpanKind&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map a CBEventType to a wandb trace tree SpanKind.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">CHUNKING</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">NODE_PARSING</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">EMBEDDING</span><span class="p">:</span>
            <span class="c1"># TODO: add span kind for EMBEDDING when it&#39;s available</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">LLM</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">LLM</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">QUERY</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">AGENT</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">AGENT_STEP</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">AGENT</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">RETRIEVE</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">TOOL</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">SYNTHESIZE</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">CHAIN</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">TREE</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">CHAIN</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">SUB_QUESTION</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">CHAIN</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">RERANKING</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">CHAIN</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">FUNCTION_CALL</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">SpanKind</span><span class="o">.</span><span class="n">TOOL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">span_kind</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">span_kind</span>

    <span class="k">def</span> <span class="nf">_add_payload_to_span</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="s2">&quot;trace_tree.Span&quot;</span><span class="p">,</span> <span class="n">event_pair</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="s2">&quot;trace_tree.Span&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the event&#39;s payload to the span.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">event_type</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">NODE_PARSING</span><span class="p">:</span>
            <span class="c1"># TODO: disabled full detailed inputs/outputs due to UI lag</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_node_parsing_payload</span><span class="p">(</span><span class="n">event_pair</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">LLM</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_llm_payload</span><span class="p">(</span><span class="n">event_pair</span><span class="p">,</span> <span class="n">span</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">QUERY</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_query_payload</span><span class="p">(</span><span class="n">event_pair</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="n">CBEventType</span><span class="o">.</span><span class="n">EMBEDDING</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_embedding_payload</span><span class="p">(</span><span class="n">event_pair</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">span</span>

    <span class="k">def</span> <span class="nf">_handle_node_parsing_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_pair</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the payload of a NODE_PARSING event.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>

        <span class="k">if</span> <span class="n">inputs</span> <span class="ow">and</span> <span class="n">EventPayload</span><span class="o">.</span><span class="n">DOCUMENTS</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">DOCUMENTS</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;num_documents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outputs</span> <span class="ow">and</span> <span class="n">EventPayload</span><span class="o">.</span><span class="n">NODES</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">NODES</span><span class="p">)</span>
            <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;num_nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span> <span class="ow">or</span> <span class="p">{},</span> <span class="n">outputs</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_handle_llm_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_pair</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">],</span> <span class="n">span</span><span class="p">:</span> <span class="s2">&quot;trace_tree.Span&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="s2">&quot;trace_tree.Span&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the payload of a LLM event.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

        <span class="c1"># Get `original_template` from Prompt</span>
        <span class="k">if</span> <span class="n">EventPayload</span><span class="o">.</span><span class="n">PROMPT</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">PROMPT</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">PROMPT</span><span class="p">]</span>

        <span class="c1"># Format messages</span>
        <span class="k">if</span> <span class="n">EventPayload</span><span class="o">.</span><span class="n">MESSAGES</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">MESSAGES</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">MESSAGES</span><span class="p">]]</span>
            <span class="p">)</span>

        <span class="n">token_counts</span> <span class="o">=</span> <span class="n">get_llm_token_counts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_counter</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;formatted_prompt_tokens_count&quot;</span><span class="p">:</span> <span class="n">token_counts</span><span class="o">.</span><span class="n">prompt_token_count</span><span class="p">,</span>
            <span class="s2">&quot;prediction_tokens_count&quot;</span><span class="p">:</span> <span class="n">token_counts</span><span class="o">.</span><span class="n">completion_token_count</span><span class="p">,</span>
            <span class="s2">&quot;total_tokens_used&quot;</span><span class="p">:</span> <span class="n">token_counts</span><span class="o">.</span><span class="n">total_token_count</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">span</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="c1"># Make `response` part of `outputs`</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">RESPONSE</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">RESPONSE</span><span class="p">])}</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">span</span>

    <span class="k">def</span> <span class="nf">_handle_query_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event_pair</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the payload of a QUERY event.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>

        <span class="k">if</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="n">response_obj</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">RESPONSE</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">RESPONSE</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;Response&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">response_obj</span><span class="o">.</span><span class="n">response</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;StreamingResponse&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">response_obj</span><span class="o">.</span><span class="n">get_response</span><span class="p">()</span><span class="o">.</span><span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">_handle_embedding_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_pair</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">event_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">event_pair</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span>

        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventPayload</span><span class="o">.</span><span class="n">CHUNKS</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">return</span> <span class="p">{},</span> <span class="p">{</span><span class="s2">&quot;num_chunks&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">_get_time_in_ms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_pair</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CBEvent</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the start and end time of an event pair in milliseconds.&quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">event_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">TIMESTAMP_FORMAT</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">event_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">TIMESTAMP_FORMAT</span><span class="p">)</span>

        <span class="n">start_time_in_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="p">(</span><span class="n">start_time</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="p">)</span>
        <span class="n">end_time_in_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">start_time_in_ms</span><span class="p">,</span> <span class="n">end_time_in_ms</span>

    <span class="k">def</span> <span class="nf">_ensure_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_print_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures an active W&amp;B run exists.</span>

<span class="sd">        If not, will start a new run with the provided run_args.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="c1"># Make a shallow copy of the run args, so we don&#39;t modify the original</span>
            <span class="n">run_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_args</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># type: ignore</span>
            <span class="n">run_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">run_args</span><span class="p">}</span>  <span class="c1"># type: ignore</span>

            <span class="c1"># Prefer to run in silent mode since W&amp;B has a lot of output</span>
            <span class="c1"># which can be undesirable when dealing with text-based models.</span>
            <span class="k">if</span> <span class="s2">&quot;settings&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">run_args</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
                <span class="n">run_args</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;silent&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>  <span class="c1"># type: ignore</span>

            <span class="c1"># Start the run and add the stream table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="o">**</span><span class="n">run_args</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">_label</span><span class="p">(</span><span class="n">repo</span><span class="o">=</span><span class="s2">&quot;llama_index&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

            <span class="k">if</span> <span class="n">should_print_url</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print_wandb_init_message</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">run_url</span>  <span class="c1"># type: ignore</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_wandb_init_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a message to the terminal when W&amp;B is initialized.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">termlog</span><span class="p">(</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="sa">f</span><span class="s2">&quot;Streaming LlamaIndex events to W&amp;B at </span><span class="si">{</span><span class="n">run_url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;`WandbCallbackHandler` is currently in beta.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Please report any issues to https://github.com/wandb/wandb/issues &quot;</span>
            <span class="s2">&quot;with the tag `llamaindex`.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_upload_index_fail_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a message to the terminal when uploading the index fails.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">termlog</span><span class="p">(</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to upload index to W&amp;B with the following error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Finish the callback handler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="llama_index.callbacks.wandb.WandbCallbackHandler.on_event_start" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_event_start</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_start" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">on_event_start</span><span class="p">(</span><span class="n">event_type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="llama_index.core.callbacks.schema.CBEventType" href="../#llama_index.core.callbacks.schema.CBEventType">CBEventType</a></span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n"><span title="typing.Dict">Dict</span></span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event_id</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Store event start data by event type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>event_type</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="llama_index.core.callbacks.schema.CBEventType" href="../#llama_index.core.callbacks.schema.CBEventType">CBEventType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>event type to store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>payload to store.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>event_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>event id to store.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent event id.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">on_event_start</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">CBEventType</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store event start data by event type.</span>

<span class="sd">    Args:</span>
<span class="sd">        event_type (CBEventType): event type to store.</span>
<span class="sd">        payload (Optional[Dict[str, Any]]): payload to store.</span>
<span class="sd">        event_id (str): event id to store.</span>
<span class="sd">        parent_id (str): parent event id.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">CBEvent</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">id_</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">id_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">id_</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_index.callbacks.wandb.WandbCallbackHandler.on_event_end" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_event_end</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler.on_event_end" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">on_event_end</span><span class="p">(</span><span class="n">event_type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="llama_index.core.callbacks.schema.CBEventType" href="../#llama_index.core.callbacks.schema.CBEventType">CBEventType</a></span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n"><span title="typing.Dict">Dict</span></span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">event_id</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Store event end data by event type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>event_type</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="llama_index.core.callbacks.schema.CBEventType" href="../#llama_index.core.callbacks.schema.CBEventType">CBEventType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>event type to store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>payload to store.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>event_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>event id to store.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">on_event_end</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">CBEventType</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store event end data by event type.</span>

<span class="sd">    Args:</span>
<span class="sd">        event_type (CBEventType): event type to store.</span>
<span class="sd">        payload (Optional[Dict[str, Any]]): payload to store.</span>
<span class="sd">        event_id (str): event id to store.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">CBEvent</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">id_</span><span class="o">=</span><span class="n">event_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">id_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_index.callbacks.wandb.WandbCallbackHandler.start_trace" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">start_trace</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler.start_trace" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">start_trace</span><span class="p">(</span><span class="n">trace_id</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Launch a trace.</p>

            <details class="quote">
              <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Launch a trace.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cur_trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_index.callbacks.wandb.WandbCallbackHandler.log_trace_tree" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">log_trace_tree</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler.log_trace_tree" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">log_trace_tree</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Log the trace tree to wandb.</p>

            <details class="quote">
              <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_trace_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the trace tree to wandb.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">child_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">]</span>
        <span class="n">root_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_event_pair_to_wb_span</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_event_pairs_by_id</span><span class="p">[</span><span class="n">child_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="n">trace_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cur_trace_id</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">child_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_map</span><span class="p">[</span><span class="n">child_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">root_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_trace_tree</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">,</span> <span class="n">root_span</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_trace_tree</span><span class="p">(</span><span class="n">child_nodes</span><span class="p">,</span> <span class="n">root_span</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">root_span</span><span class="p">:</span>
            <span class="n">root_trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_tree</span><span class="o">.</span><span class="n">WBTraceTree</span><span class="p">(</span><span class="n">root_span</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="n">root_trace</span><span class="p">})</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">termlog</span><span class="p">(</span><span class="s2">&quot;Logged trace tree to W&amp;B.&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to log trace tree to W&amp;B: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_index.callbacks.wandb.WandbCallbackHandler.persist_index" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">persist_index</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler.persist_index" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">persist_index</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n"><span title="llama_index.callbacks.wandb.base.IndexType">IndexType</span></span><span class="p">,</span> <span class="n">index_name</span><span class="p">:</span> <span class="n">str</span><span class="p">,</span> <span class="n">persist_dir</span><span class="p">:</span> <span class="n"><span title="typing.Union">Union</span></span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Upload an index to wandb as an artifact. You can learn more about W&amp;B
artifacts here: https://docs.wandb.ai/guides/artifacts.</p>
<p>For the <code>ComposableGraph</code> index, the root id is stored as artifact metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>index</code>
            </td>
            <td>
                  <code><span title="llama_index.callbacks.wandb.base.IndexType">IndexType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index to upload.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the index. This will be used as the artifact name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>persist_dir</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>directory to persist the index. If None, a
temporary directory will be created and used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">persist_index</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="s2">&quot;IndexType&quot;</span><span class="p">,</span> <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">persist_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload an index to wandb as an artifact. You can learn more about W&amp;B</span>
<span class="sd">    artifacts here: https://docs.wandb.ai/guides/artifacts.</span>

<span class="sd">    For the `ComposableGraph` index, the root id is stored as artifact metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        index (IndexType): index to upload.</span>
<span class="sd">        index_name (str): name of the index. This will be used as the artifact name.</span>
<span class="sd">        persist_dir (Union[str, None]): directory to persist the index. If None, a</span>
<span class="sd">            temporary directory will be created and used.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">persist_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">persist_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">dir</span><span class="si">}</span><span class="s2">/storage&quot;</span>  <span class="c1"># type: ignore</span>
        <span class="n">_default_persist_dir</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IndexType</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span><span class="o">.</span><span class="n">storage_context</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># For the `ComposableGraph` index, store the root id as metadata</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IndexType</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">root_id</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">root_id</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;root_id&quot;</span><span class="p">:</span> <span class="n">root_id</span><span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_index_as_wb_artifact</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">,</span> <span class="n">index_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Silently ignore errors to not break user code</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_upload_index_fail_message</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="c1"># clear the default storage dir</span>
    <span class="k">if</span> <span class="n">_default_persist_dir</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">persist_dir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_index.callbacks.wandb.WandbCallbackHandler.load_storage_context" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_storage_context</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler.load_storage_context" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_storage_context</span><span class="p">(</span><span class="n">artifact_url</span><span class="p">:</span> <span class="n">str</span><span class="p">,</span> <span class="n">index_download_dir</span><span class="p">:</span> <span class="n"><span title="typing.Union">Union</span></span><span class="p">[</span><span class="n">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="llama_index.core.storage.storage_context.StorageContext" href="../../storage/storage_context/#llama_index.core.storage.storage_context.StorageContext">StorageContext</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Download an index from wandb and return a storage context.</p>
<p>Use this storage context to load the index into memory using
<code>load_index_from_storage</code>, <code>load_indices_from_storage</code> or
<code>load_graph_from_storage</code> functions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>artifact_url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>url of the artifact to download. The artifact url will
be of the form: <code>entity/project/index_name:version</code> and can be found in
the W&amp;B UI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_download_dir</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>directory to download the index to.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_storage_context</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">artifact_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index_download_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StorageContext&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download an index from wandb and return a storage context.</span>

<span class="sd">    Use this storage context to load the index into memory using</span>
<span class="sd">    `load_index_from_storage`, `load_indices_from_storage` or</span>
<span class="sd">    `load_graph_from_storage` functions.</span>

<span class="sd">    Args:</span>
<span class="sd">        artifact_url (str): url of the artifact to download. The artifact url will</span>
<span class="sd">            be of the form: `entity/project/index_name:version` and can be found in</span>
<span class="sd">            the W&amp;B UI.</span>
<span class="sd">        index_download_dir (Union[str, None]): directory to download the index to.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">llama_index.core.storage.storage_context</span> <span class="kn">import</span> <span class="n">StorageContext</span>

    <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">use_artifact</span><span class="p">(</span><span class="n">artifact_url</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;storage_context&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="n">artifact_dir</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">index_download_dir</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StorageContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="n">artifact_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_index.callbacks.wandb.WandbCallbackHandler.finish" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">finish</span>


<a href="#llama_index.callbacks.wandb.WandbCallbackHandler.finish" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">finish</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Finish the callback handler.</p>

            <details class="quote">
              <summary>Source code in <code>llama_index\callbacks\wandb\base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finish the callback handler.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
       
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../uptrain/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Uptrain">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Uptrain
              </div>
            </div>
          </a>
        
        
          
          <a href="../../chat_engines/condense_plus_context/" class="md-footer__link md-footer__link--next" aria-label="Next: Condense plus context">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Condense plus context
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <readthedocs-flyout position="bottom-left"></readthedocs-flyout>
      
    </div>
  </div>
</footer>
      
<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-WWRFB36R");
</script>
<!-- End Google Tag Manager -->

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.prune", "navigation.tabs", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "content.code.copy", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascript/runllm.js"></script>
      
        <script src="../../../javascript/algolia.js"></script>
      
    
  </body>
</html>